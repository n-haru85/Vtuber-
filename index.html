<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>キャラクターカタログ（Firebaseリアルタイム）</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family:"Segoe UI"; background:#1e1e2f; color:#eee; max-width:800px; margin:20px auto; padding:20px; border-radius:12px; }
    h1 { text-align:center; color:#ffd700; }
    .options { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:16px; }
    .option { background:#2e2e3e; padding:8px 12px; border-radius:6px; cursor:pointer; min-width:40px; text-align:center; transition: all 0.2s ease; }
    .option:hover { background:#3e3e5e; transform: scale(1.05); }
    .option.selected { background:#ffd700; color:#000; font-weight:bold; transform: scale(1.1); }
    button { margin-top:16px; padding:10px 20px; border:none; border-radius:8px; background:#4caf50; color:white; cursor:pointer; transition:0.2s; }
    button:hover { background:#43a047; transform:scale(1.05); }
    .hidden { display:none; }
    #viewer { background:#2e2e3e; padding:20px; border-radius:8px; margin-top:20px; }
    #summary-box { position:absolute; bottom:10px; right:10px; background:rgba(255,215,0,0.9); color:#000; padding:8px 12px; border-radius:6px; font-size:0.85em; }
    input[type=number] { width:100px; padding:6px; border-radius:6px; border:1px solid #ccc; margin-bottom:12px; }
  </style>
</head>
<body>

<h1>キャラクターカタログ（Firebaseリアルタイム）</h1>

<div id="mode-selection">
  <p>モードを選んでください：</p>
  <button onclick="startMode('選ぶ')">選ぶ側</button>
  <button onclick="startMode('閲覧')">閲覧モード</button>
</div>

<div id="selection-area" class="hidden">
  <div>
    <p>髪型（1〜47）</p><div class="options" id="hair-list"></div>
    <p>目（1〜5）</p><div class="options" id="eye-list"></div>
    <p>衣装（1〜5）</p><div class="options" id="clothes-list"></div>
    <p>体型（1〜4）</p><div class="options" id="taikei-list"></div>
    <p>性別（1〜3）</p><div class="options" id="seibetu-list"></div>
    <p>装飾品（0〜19）</p><div class="options" id="sousyoku-list"></div>
    <p>身長（100〜200cm）</p><input type="number" id="height" min="100" max="200" step="0.1">
  </div>
  <button onclick="sendSelection()">送信（Firebaseへ）</button>
</div>

<div id="viewer" class="hidden">
  <h2>閲覧モード（リアルタイム）</h2>
  <button onclick="restart()">最初から戻る</button>
  <div id="summary-box-viewer"></div>
</div>

<script>
  // ==== Firebase 設定 ====
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ==== 選択肢生成 ====
  function createOptions(id,count,startFromZero=false){
    const container=document.getElementById(id);
    const start = startFromZero ? 0 : 1;
    const end = startFromZero ? count-1 : count;
    for(let i=start;i<=end;i++){
      const div=document.createElement('div');
      div.textContent=i;
      div.className='option';
      div.onclick=()=> {
        [...container.children].forEach(el=>el.classList.remove('selected'));
        div.classList.add('selected');
        updateViewer(); // 閲覧モード用に常時更新
      };
      container.appendChild(div);
    }
  }

  createOptions('hair-list',47);       // 1〜47
  createOptions('eye-list',5);         // 1〜5
  createOptions('clothes-list',5);     // 1〜5
  createOptions('taikei-list',4);      // 1〜4
  createOptions('seibetu-list',3);     // 1〜3
  createOptions('sousyoku-list',20,true); // 0〜19

  function getSelected(id){
    const sel=document.querySelector(`#${id} .option.selected`);
    return sel?sel.textContent:null;
  }

  function getAllSelection(){
    return {
      hair:getSelected('hair-list'),
      eye:getSelected('eye-list'),
      clothes:getSelected('clothes-list'),
      taikei:getSelected('taikei-list'),
      seibetu:getSelected('seibetu-list'),
      sousyoku:getSelected('sousyoku-list'),
      height:document.getElementById('height').value
    };
  }

  function formatSummary(sel){
    return `
      髪型:${sel.hair||'-'}<br>
      目:${sel.eye||'-'}<br>
      衣装:${sel.clothes||'-'}<br>
      体型:${sel.taikei||'-'}<br>
      性別:${sel.seibetu||'-'}<br>
      装飾品:${sel.sousyoku||'-'}<br>
      身長:${sel.height?parseFloat(sel.height).toFixed(1):'-'} cm
    `;
  }

  // ==== モード切替 ====
  function startMode(mode){
    document.getElementById('mode-selection').classList.add('hidden');
    document.getElementById('selection-area').classList.remove('hidden');
    if(mode==='閲覧'){
      document.getElementById('selection-area').classList.add('hidden'); // 閲覧は選択不可
      document.getElementById('viewer').classList.remove('hidden');
      // リアルタイム監視
      const ref=db.ref('currentSelection');
      ref.on('value',(snapshot)=>{
        const val=snapshot.val();
        if(val) document.getElementById('summary-box-viewer').innerHTML=formatSummary(val);
      });
    }
  }

  // ==== 選ぶ側が送信 ====
  function sendSelection(){
    const sel=getAllSelection();
    if(!sel.hair||!sel.eye||!sel.clothes||!sel.taikei||!sel.seibetu||sel.sousyoku===null||!sel.height){
      alert("すべての項目を選択してください。");
      return;
    }
    db.ref('currentSelection').set(sel);
    alert("選択内容を送信しました！");
  }

  // ==== 戻る ====
  function restart(){
    document.querySelectorAll('.option.selected').forEach(el=>el.classList.remove('selected'));
    document.getElementById('height').value='';
    document.getElementById('selection-area').classList.add('hidden');
    document.getElementById('viewer').classList.add('hidden');
    document.getElementById('mode-selection').classList.remove('hidden');
    document.getElementById('summary-box-viewer').innerHTML='';
  }
</script>

</body>
</html>
