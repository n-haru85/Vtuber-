<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>キャラクターカタログ（復元＆編集）</title>
<style>
  body { font-family:"Segoe UI"; background:#1e1e2f; color:#eee; max-width:800px; margin:20px auto; padding:20px; border-radius:12px; }
  h1 { text-align:center; color:#ffd700; }
  .options { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:16px; }
  .option { background:#2e2e3e; padding:8px 12px; border-radius:6px; cursor:pointer; min-width:40px; text-align:center; transition: all 0.2s ease; }
  .option:hover { background:#3e3e5e; transform: scale(1.05); }
  .option.selected { background:#ffd700; color:#000; font-weight:bold; transform: scale(1.1); }
  button { margin-top:16px; padding:10px 20px; border:none; border-radius:8px; background:#4caf50; color:white; cursor:pointer; transition:0.2s; }
  button:hover { background:#43a047; transform:scale(1.05); }
  input[type=number] { width:100px; padding:6px; border-radius:6px; border:1px solid #ccc; margin-bottom:12px; }
  #summary-box { background:#2e2e3e; padding:20px; border-radius:8px; margin-top:20px; }
</style>
</head>
<body>

<h1>キャラクターカタログ（復元＆編集）</h1>

<div>
  <p>髪型（1〜47）</p><div class="options" id="hair-list"></div>
  <p>目（1〜5）</p><div class="options" id="eye-list"></div>
  <p>衣装（1〜5）</p><div class="options" id="clothes-list"></div>
  <p>体型（1〜4）</p><div class="options" id="taikei-list"></div>
  <p>性別（1〜3）</p><div class="options" id="seibetu-list"></div>
  <p>装飾品（0〜19）</p><div class="options" id="sousyoku-list"></div>
  <p>身長（100〜200cm）</p><input type="number" id="height" min="100" max="200" step="0.1">
</div>

<button onclick="saveSelection()">選択結果を保存</button>
<button onclick="loadSelection()">保存ファイルを読み込む</button>

<div id="summary-box"></div>

<input type="file" id="file-input" style="display:none" accept=".json">

<script>
  // 選択肢生成
  function createOptions(id,count,startFromZero=false){
    const container=document.getElementById(id);
    const start = startFromZero ? 0 : 1;
    const end = startFromZero ? count-1 : count;
    for(let i=start;i<=end;i++){
      const div=document.createElement('div');
      div.textContent=i;
      div.className='option';
      div.onclick=()=>{
        [...container.children].forEach(el=>el.classList.remove('selected'));
        div.classList.add('selected');
        updateSummary();
      };
      container.appendChild(div);
    }
  }

  createOptions('hair-list',47);
  createOptions('eye-list',5);
  createOptions('clothes-list',5);
  createOptions('taikei-list',4);
  createOptions('seibetu-list',3);
  createOptions('sousyoku-list',20,true);

  // 選択内容取得
  function getSelected(id){
    const sel=document.querySelector(`#${id} .option.selected`);
    return sel?sel.textContent:null;
  }

  function getAllSelection(){
    return {
      hair:getSelected('hair-list'),
      eye:getSelected('eye-list'),
      clothes:getSelected('clothes-list'),
      taikei:getSelected('taikei-list'),
      seibetu:getSelected('seibetu-list'),
      sousyoku:getSelected('sousyoku-list'),
      height:document.getElementById('height').value
    };
  }

  // サマリ更新
  function updateSummary(sel=null){
    if(!sel) sel=getAllSelection();
    document.getElementById('summary-box').innerHTML = `
      髪型: ${sel.hair||'-'}<br>
      目: ${sel.eye||'-'}<br>
      衣装: ${sel.clothes||'-'}<br>
      体型: ${sel.taikei||'-'}<br>
      性別: ${sel.seibetu||'-'}<br>
      装飾品: ${sel.sousyoku||'-'}<br>
      身長: ${sel.height?parseFloat(sel.height).toFixed(1):'-'} cm
    `;
  }

  // 保存
  function saveSelection(){
    const sel=getAllSelection();
    if(!sel.hair||!sel.eye||!sel.clothes||!sel.taikei||!sel.seibetu||sel.sousyoku===null||!sel.height){
      alert("すべての項目を選択してください。");
      return;
    }
    const blob = new Blob([JSON.stringify(sel, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'character_selection.json';
    a.click();
    URL.revokeObjectURL(url);
  }

  // 読み込み
  function loadSelection(){
    const fileInput = document.getElementById('file-input');
    fileInput.click();
    fileInput.onchange = e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = event => {
        try{
          const data = JSON.parse(event.target.result);
          // 選択状態を反映
          ['hair','eye','clothes','taikei','seibetu','sousyoku'].forEach(id=>{
            const container = document.getElementById(id+'-list');
            [...container.children].forEach(el=>{
              el.classList.remove('selected');
              if(el.textContent===data[id]) el.classList.add('selected');
            });
          });
          document.getElementById('height').value = data.height;
          updateSummary(data);
        } catch(err){
          alert('JSONの読み込みに失敗しました: ' + err);
        }
      };
      reader.readAsText(file);
    };
  }
</script>

</body>

